<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Something you probably didn’t know about C/C++ | Raycast</title>

		<link href="/css/vendor/bootstrap.min.css" rel="stylesheet">
    	<link href="/css/flat-ui.min.css" rel="stylesheet">
		<link rel="stylesheet" href="/css/style.css"/>
		<link rel="stylesheet" href="/css/syntax.css" media="screen"/>
		<link rel="stylesheet" href="/css/fancybox/jquery.fancybox.css" media="screen"/>
		<link rel="stylesheet" href="/css/fancybox/jquery.fancybox-buttons.css" media="screen" />
		<link rel="stylesheet" href="/css/fancybox/jquery.fancybox-thumbs.css" media="screen" />
		<link rel="shortcut icon" type="image/png" href="/images/gamepad.png">
	</head>
	<body>
		<div class="container page">
			<div class="navbar navbar-default" role="navigation">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="/">
				<img src="/images/gamepad_large.png"/>
			</a>
			<div class="navbar-text">Home page of one programmer</div>
		</div>
		<ul class="nav navbar-nav navbar-right">
			<li><a href="/">Articles</a></li>
			<li><a href="/portfolio/">Portfolio</a></li>
			<li><a href="/about/">About</a></li>
		</ul>
	</div>
</div>


			<div class="content">
				<div class="article">
	<div class="row">
		<div class="col-xs-12">
			<h2>Something you probably didn’t know about C/C++</h2>
			
				<span class="small text-muted">09 Mar 2013</span>
			
		</div>
	</div>
	
	<div class="article-content">
		<p>I love to collect mind-blowing and not too widely known C/C++ language constructions and facts. This post carries my collection and will be updated
when new entries appear.</p>

<p>C/C++</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// zero-sized bit fields
</span><span class="k">struct</span> <span class="n">S</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span>
  <span class="o">:</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">d</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<!--break-->

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Exit code when there's no return statement?
</span><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Test</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The program exit code will be... ? 5. When there is no return statement,
// the program will return the result of the last executed function.
</span><span class="o">//</span> <span class="n">In</span> <span class="k">this</span> <span class="k">case</span> <span class="n">it</span> <span class="n">is</span> <span class="mi">5</span><span class="p">,</span> <span class="n">because</span> <span class="n">printf</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">symbols</span> <span class="n">actually</span> <span class="n">printed</span><span class="p">.</span></code></pre></figure>

<p>C/C++</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// a[b] is practically the same as *(a + b)
</span><span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">4</span><span class="p">[</span><span class="s">"Hello, world!"</span><span class="p">];</span> <span class="o">//</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">'o'</span></code></pre></figure>

<p>C/C++</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">f</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1045</span><span class="p">;</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// returns 1045
</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">33</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">f</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1045</span><span class="p">;</span>
  <span class="p">{</span>
    <span class="k">extern</span> <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="c1">// returns 33
</span>  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Passed array must have at least 10 elements (-Warray-bounds):
</span><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="k">static</span> <span class="mi">10</span><span class="p">])</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Free compile-time not-NULL check [-Wnonnull]
</span><span class="kt">void</span> <span class="nf">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="k">static</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span> <span class="p">}</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="err">'</span><span class="n">FOO</span><span class="o">!</span><span class="err">'</span><span class="p">;</span> <span class="o">//</span> <span class="n">single</span> <span class="n">quotes</span><span class="o">!</span> <span class="n">codepad</span><span class="p">.</span><span class="n">org</span> <span class="n">compiler</span> <span class="n">says</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1179602721</span></code></pre></figure>

<p>C/C++</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">+++</span><span class="n">z</span><span class="p">;</span> <span class="c1">// parsed as y++ + z ("greedy lexer rule")
</span><span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="o">+++++</span><span class="n">c</span><span class="p">;</span> <span class="o">//</span> <span class="n">b</span><span class="o">++</span> <span class="o">++</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="n">not</span> <span class="n">b</span><span class="o">++</span> <span class="o">+</span> <span class="o">++</span><span class="n">c</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// The shortest C-program that compiles and links. With a warning. Do not run!
</span><span class="n">main</span><span class="p">;</span>
<span class="c1">// No warnings. Do not run either!
</span><span class="kt">int</span> <span class="n">main</span><span class="p">;</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Old-style function definition
</span><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
<span class="kt">int</span> <span class="n">argc</span><span class="p">;</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[];</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">return</span> <span class="p">((</span><span class="kt">int</span> <span class="p">[]){</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">})[</span><span class="mi">1</span><span class="p">];</span>
<span class="o">//</span> <span class="n">returns</span> <span class="mi">2</span></code></pre></figure>

<p>C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Initializer with designators hell
</span><span class="k">struct</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
   <span class="k">struct</span> <span class="p">{</span>
       <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">;</span>
   <span class="p">}</span> <span class="n">nested</span><span class="p">;</span>
<span class="p">}</span> <span class="n">i</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">nested</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">};</span>  
<span class="o">//</span> <span class="n">i</span><span class="p">.</span><span class="n">nested</span><span class="p">.</span><span class="n">y</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">nested</span><span class="p">.</span><span class="n">z</span> <span class="o">==</span> <span class="mi">6</span></code></pre></figure>

<p>GCC C-only</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// omit second component of ?: operator
</span><span class="k">extern</span> <span class="kt">int</span> <span class="n">f</span><span class="p">();</span>
<span class="k">return</span> <span class="n">f</span><span class="p">()</span> <span class="o">?</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="o">//</span> <span class="n">Returns</span> <span class="n">f</span><span class="p">()</span> <span class="k">if</span> <span class="n">it</span><span class="err">'</span><span class="n">s</span> <span class="n">not</span> <span class="n">zero</span><span class="p">,</span> <span class="n">or</span> <span class="o">-</span><span class="mi">1</span> <span class="n">otherwise</span><span class="p">.</span> <span class="n">Reminds</span> <span class="n">me</span> <span class="n">of</span> <span class="n">C</span><span class="err">#</span> <span class="k">operator</span> <span class="o">??</span></code></pre></figure>

<p>C/C++</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// zero-sized bit fields
</span><span class="k">struct</span> <span class="n">S</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">c</span><span class="o">:</span><span class="mi">6</span><span class="p">,</span>
  <span class="o">:</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">d</span><span class="p">;</span>
<span class="p">};</span></code></pre></figure>

<p>Most interesting parts of <a href="http://nickdesaulniers.github.io/blog/2013/07/25/designated-initialization-with-pointers-in-c/">this</a>
article about designated initialization in C:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="n">point</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">// ...
</span><span class="k">struct</span> <span class="n">point</span> <span class="n">p</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">//</span> <span class="n">ok</span><span class="p">,</span> <span class="n">p</span> <span class="n">now</span> <span class="n">has</span> <span class="n">coordinates</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">struct</span> <span class="n">point</span> <span class="n">p</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">//</span> <span class="n">ok</span><span class="p">,</span> <span class="n">p</span> <span class="n">now</span> <span class="n">has</span> <span class="n">coordinates</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Re-assign? No problems, but tricky
</span><span class="k">struct</span> <span class="n">point</span> <span class="n">p</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">};</span>
<span class="c1">// ...
</span><span class="n">p</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span> <span class="p">};</span> <span class="c1">// compilation error
</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">point</span><span class="p">){</span> <span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span> <span class="p">};</span> <span class="c1">// works
</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">point</span><span class="p">){</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span> <span class="p">};</span> <span class="o">//</span> <span class="k">this</span> <span class="n">works</span> <span class="n">too</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">distance</span><span class="p">(</span><span class="k">struct</span> <span class="n">point</span> <span class="n">a</span><span class="p">,</span> <span class="k">struct</span> <span class="n">point</span> <span class="n">b</span><span class="p">);</span>
<span class="c1">// ...
</span><span class="n">distance</span><span class="p">({</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span> <span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">});</span> <span class="c1">// no-no, compilation error
</span><span class="n">distance</span><span class="p">((</span><span class="k">struct</span> <span class="n">point</span><span class="p">){</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span> <span class="p">(</span><span class="k">struct</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">});</span> <span class="o">//</span> <span class="n">fine</span><span class="p">,</span> <span class="k">this</span> <span class="n">compiles</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="c1">// Initializing pointer members
</span><span class="k">struct</span> <span class="n">node</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">node</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">// ...
</span><span class="k">struct</span> <span class="n">node</span> <span class="n">n</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">"Hello, world!"</span><span class="p">,</span>
  <span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="k">struct</span> <span class="n">node</span><span class="p">)</span> <span class="p">{</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">"Next node"</span> <span class="p">})</span> <span class="c1">// wow!
</span><span class="p">}</span></code></pre></figure>

<p>Empty declarations in C:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="k">typedef</span><span class="p">;</span>
<span class="kt">int</span> <span class="k">typedef</span> <span class="k">const</span><span class="p">;</span></code></pre></figure>

<p>Won’t compile with <code>-Wall</code> though.</p>

<p>Some people write such code probably hoping that C/C++ has native support for tuples. No, it doesn’t.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="nf">func</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ...
</span>
<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">func</span><span class="p">();</span> <span class="o">//</span> <span class="n">d</span> <span class="o">==</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="k">if</span> <span class="p">()</span> <span class="k">operator</span> <span class="n">is</span> <span class="n">not</span> <span class="n">overloaded</span></code></pre></figure>

<p>This construction is strange in a way that you probably won&#39;t encounter it very often. For some reasons it&#39;s not commonly used. The <a href="http://en.cppreference.com/w/cpp/language/function-try-block">function-try-block</a>:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><span class="kt">int</span> <span class="n">f</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="n">try</span> <span class="p">{</span>
  <span class="o">++</span><span class="n">n</span><span class="p">;</span> <span class="c1">// increments the function parameter
</span>  <span class="k">throw</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(...)</span> <span class="p">{</span>
  <span class="o">++</span><span class="n">n</span><span class="p">;</span> <span class="c1">// n is in scope and still refers to the function parameter
</span>  <span class="n">assert</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

	</div>
</div>

			<div>

			

		</div>

		<div class="footer">
	<p class="text-muted">© 2014-2016 Aleksey Fedotov</p>
</div>

<script src="/js/vendor/jquery.min.js"></script>
<script src="/js/vendor/video.js"></script>
<script src="/js/flat-ui.min.js"></script>
<script src="/js/fancybox/jquery.fancybox.pack.js"></script>
<script src="/js/fancybox/jquery.fancybox-buttons.js"></script>
<script src="/js/fancybox/jquery.fancybox-media.js"></script>
<script src="/js/fancybox/jquery.fancybox-thumbs.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-50872849-1', 'raycast.net');
  ga('send', 'pageview', {
    "page": "/odd-cpp",
    "title": 'Something you probably didn’t know about C/C++'
  });
</script>

<script>
	$(document).ready(function() {
		$(".lightbox").fancybox();
	});
</script>

	</body>
</html>
